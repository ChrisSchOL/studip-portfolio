(function(){!function($){return $.fn.ajaxChosen=function(settings,callback,chosenOptions){var chosenXhr,defaultOptions,options,select;return null==settings&&(settings={}),null==chosenOptions&&(chosenOptions={}),defaultOptions={minTermLength:3,afterTypeDelay:500,jsonTermKey:"term",keepTypingMsg:"Keep typing...",lookingForMsg:"Looking for"},select=this,chosenXhr=null,options=$.extend({},defaultOptions,$(select).data(),settings),this.chosen(chosenOptions?chosenOptions:{}),this.each(function(){return $(this).next(".chosen-container").find(".search-field > input, .chosen-search > input").bind("keyup",function(){var field,msg,success,untrimmed_val,val;return untrimmed_val=$(this).val(),val=$.trim($(this).val()),msg=val.length<options.minTermLength?options.keepTypingMsg:options.lookingForMsg+(" '"+val+"'"),select.next(".chosen-container").find(".no-results").text(msg),val===$(this).data("prevVal")?!1:($(this).data("prevVal",val),this.timer&&clearTimeout(this.timer),val.length<options.minTermLength?!1:(field=$(this),null==options.data&&(options.data={}),options.data[options.jsonTermKey]=val,null!=options.dataCallback&&(options.data=options.dataCallback(options.data)),success=options.success,options.success=function(data){var items,nbItems,selected_values;if(null!=data)return selected_values=[],select.find("option").each(function(){return $(this).is(":selected")?selected_values.push($(this).val()+"-"+$(this).text()):$(this).remove()}),select.find("optgroup:empty").each(function(){return $(this).remove()}),items=null!=callback?callback(data,field):data,nbItems=0,$.each(items,function(i,element){var group,text,value;return nbItems++,element.group?(group=select.find("optgroup[label='"+element.text+"']"),group.size()||(group=$("<optgroup />")),group.attr("label",element.text).appendTo(select),$.each(element.items,function(i,element){var text,value;return"string"==typeof element?(value=i,text=element):(value=element.value,text=element.text),-1===$.inArray(value+"-"+text,selected_values)?$("<option />").attr("value",value).html(text).appendTo(group):void 0})):("string"==typeof element?(value=i,text=element):(value=element.value,text=element.text),-1===$.inArray(value+"-"+text,selected_values)?$("<option />").attr("value",value).html(text).appendTo(select):void 0)}),nbItems?select.trigger("chosen:updated"):(select.data().chosen.no_results_clear(),select.data().chosen.no_results(field.val())),null!=settings.success&&settings.success(data),field.val(untrimmed_val)},this.timer=setTimeout(function(){return chosenXhr&&chosenXhr.abort(),chosenXhr=$.ajax(options)},options.afterTypeDelay)))})})}}(jQuery)}).call(this);